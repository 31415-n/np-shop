function proxy(a)return component.proxy(component.list(a)())end;function clear()gpu.setBackground(0x0a0a0a)gpu.fill(1,1,60,19," ")end;local b=proxy("eeprom")gpu=proxy("gpu")internet=proxy("internet")gpu.bind(component.list("screen")(),true)gpu.setResolution(60,19)gpu.setForeground(0x68f029)clear()gpu.set(23,9,"Инициализация...")local c=false;local d={computer.users()}admins={}for e=1,#admins do computer.addUser(admins[e])admins[admins[e]],admins[e]=true,nil end;for f=1,#d do if not admins[d[f]]then computer.removeUser(d[f])end end;if b.getData()=="true"then dev=true else dev=false end;local function g()clear()gpu.set(18,8,"CTRL+A — режим разработки")gpu.set(18,9,"CTRL+S — запуск программы")gpu.set(16,10,"CTRL+D — обновление программы")gpu.set(12,11,"CTRL+ALT+C — принудительная остановка")end;local function h(i)clear()gpu.setForeground(0xff0000)gpu.set(23,1,"Фатальная ошибка!")gpu.setForeground(0x68f029)local j,k={}for l in i:gmatch("[^\r\n]+")do l=l:gsub("\t","")if unicode.len(l)>60 then for m=1,math.ceil(unicode.len(l)/60)do local n=m*60;j[#j+1]=unicode.sub(l,n-59,n)end else j[#j+1]=l end end;local k=11-#j/2;for m=1,#j do gpu.set(math.floor(31-unicode.len(j[m])/2),k,j[m])k=k+1 end end;local function o()for p in component.list("filesystem")do if p~=computer.tmpAddress()and not component.invoke(p,"isReadOnly")then filesystem=component.proxy(p)return true end end;if not filesystem then h("Файловая система не найдена!")end end;local function execute(r)local s,i=load(r,"=shop.lua","t")if not s and i then h(i)else local t,i=xpcall(s,debug.traceback)if not t and i then h(i)end end end;local function u()clear()if not dev then gpu.set(16,9,"Включение режима разработки...")b.setData("true")dev=true else gpu.set(15,9,"Выключение режима разработки...")b.setData("false")dev=false end;g()end;local function v()clear()gpu.set(20,9,"Обновление программы...")write("/shop.lua","w",request("https://nitrogen.one/shop.lua"))end;local function run(x)if not filesystem.exists("/shop.lua")then v()end;if filesystem.exists("/shop.lua")and not x then clear()gpu.set(25,9,"Загрузка...")c=true;execute(read("/shop.lua"))c=false end end;local y=computer.pullSignal;computer.pullSignal=function(...)local z={y(...)}if z[1]=="key_down"then if z[4]==29 then isControlDown=true elseif z[4]==42 then ifShiftDown=true elseif z[4]==56 then isAltDown=true elseif isControlDown and admins[z[5]]and filesystem then if c then if z[4]==46 and isAltDown then error("interrupted")end else if z[4]==30 then u()elseif z[4]==31 then run()elseif z[4]==32 then v()run()end end end elseif z[1]=="key_up"then if z[4]==29 then isControlDown=false elseif z[4]==42 then ifShiftDown=false elseif z[4]==56 then isAltDown=false end end;return table.unpack(z)end;function read(A)local B=filesystem.open(A,"r")local r=""while true do local s=filesystem.read(B,2048)if s then r=r..s else break end end;filesystem.close(B)return r end;function write(A,C,r)local B=filesystem.open(A,C)filesystem.write(B,r)filesystem.close(B)end;function request(A)local B,r,s=internet.request(A),""while true do s=B.read(math.huge)if s then r=r..s else break end end;B.close()return r end;function sleep(D)local E=computer.uptime()+(D or math.huge)repeat computer.pullSignal(E-computer.uptime())until computer.uptime()>=E end;o()if filesystem then g()end; while true do computer.pullSignal(math.huge)end
